(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{kSMX:function(t,e,i){"use strict";function r(t){let e=t[0],i=t[1],r=t[2];return Math.sqrt(e*e+i*i+r*r)}function s(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function n(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function a(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function h(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function o(t,e){let i=e[0],r=e[1],s=e[2],n=i*i+r*r+s*s;return n>0&&(n=1/Math.sqrt(n)),t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function l(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}i("PF2M"),i("IZzc"),Object.defineProperty(e,"__esModule",{value:!0});const u=function(){const t=[0,0,0],e=[0,0,0];return function(i,r){s(t,i),s(e,r),o(t,t),o(e,e);let n=l(t,e);return n>1?0:n<-1?Math.PI:Math.acos(n)}}();class d extends Array{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t),this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}set(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;return t.length?this.copy(t):(function(t,e,i,r){t[0]=e,t[1]=i,t[2]=r}(this,t,e,i),this)}copy(t){return s(this,t),this}add(t,e){return e?n(this,t,e):n(this,this,t),this}sub(t,e){return e?a(this,t,e):a(this,this,t),this}multiply(t){var e,i,r;return t.length?(i=this,r=t,(e=this)[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2]):h(this,this,t),this}divide(t){var e,i,r;return t.length?(i=this,r=t,(e=this)[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2]):h(this,this,1/t),this}inverse(){var t,e;return e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,(t=this)[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],this}len(){return r(this)}distance(t){return t?function(t,e){let i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(i*i+r*r+s*s)}(this,t):r(this)}squaredLen(){return this.squaredDistance()}squaredDistance(t){return t?function(t,e){let i=e[0]-t[0],r=e[1]-t[1],s=e[2]-t[2];return i*i+r*r+s*s}(this,t):function(t){let e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r}(this)}negate(){var t,e;return e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,(t=this)[0]=-e[0],t[1]=-e[1],t[2]=-e[2],this}cross(t,e){return function(t,e,i){let r=e[0],s=e[1],n=e[2],a=i[0],h=i[1],o=i[2];t[0]=s*o-n*h,t[1]=n*a-r*o,t[2]=r*h-s*a}(this,t,e),this}scale(t){return h(this,this,t),this}normalize(){return o(this,this),this}dot(t){return l(this,t)}equals(t){return i=t,(e=this)[0]===i[0]&&e[1]===i[1]&&e[2]===i[2];var e,i}applyMatrix4(t){return function(t,e,i){let r=e[0],s=e[1],n=e[2],a=i[3]*r+i[7]*s+i[11]*n+i[15];a=a||1,t[0]=(i[0]*r+i[4]*s+i[8]*n+i[12])/a,t[1]=(i[1]*r+i[5]*s+i[9]*n+i[13])/a,t[2]=(i[2]*r+i[6]*s+i[10]*n+i[14])/a}(this,this,t),this}applyQuaternion(t){return function(t,e,i){let r=e[0],s=e[1],n=e[2],a=i[0],h=i[1],o=i[2],l=h*n-o*s,u=o*r-a*n,d=a*s-h*r,c=h*d-o*u,g=o*l-a*d,p=a*u-h*l,m=2*i[3];l*=m,u*=m,d*=m,c*=2,g*=2,p*=2,t[0]=r+l+c,t[1]=s+u+g,t[2]=n+d+p}(this,this,t),this}angle(t){return u(this,t)}lerp(t,e){return function(t,e,i,r){let s=e[0],n=e[1],a=e[2];t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n),t[2]=a+r*(i[2]-a)}(this,this,t,e),this}clone(){return new d(this[0],this[1],this[2])}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t}transformDirection(t){const e=this[0],i=this[1],r=this[2];return this[0]=t[0]*e+t[4]*i+t[8]*r,this[1]=t[1]*e+t[5]*i+t[9]*r,this[2]=t[2]*e+t[6]*i+t[10]*r,this.normalize()}}const c=new d;let g=0,p=0;class m{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.attributes=e,this.id=g++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(let i in e)this.addAttribute(i,e[i])}addAttribute(t,e){if(this.attributes[t]=e,e.id=p++,e.size=e.size||1,e.type=e.type||(e.data.constructor===Float32Array?this.gl.FLOAT:e.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),e.target="index"===t?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,e.normalize=e.normalize||!1,e.buffer=this.gl.createBuffer(),e.count=e.data.length/e.size,e.divisor=e.instanced||0,e.needsUpdate=!1,this.updateAttribute(e),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor);this.instancedCount=e.count*e.divisor}else"index"===t?this.drawRange.count=e.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))}updateAttribute(t){this.glState.boundBuffer!==t.id&&(this.gl.bindBuffer(t.target,t.buffer),this.glState.boundBuffer=t.id),this.gl.bufferData(t.target,t.data,this.gl.STATIC_DRAW),t.needsUpdate=!1}setIndex(t){this.addAttribute("index",t)}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}setInstancedCount(t){this.instancedCount=t}createVAO(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.bindAttributes(t)}bindAttributes(t){t.attributeLocations.forEach((t,e)=>{if(!this.attributes[e])return void console.warn("active attribute ".concat(e," not being supplied"));const i=this.attributes[e];this.gl.bindBuffer(i.target,i.buffer),this.glState.boundBuffer=i.id,this.gl.vertexAttribPointer(t,i.size,i.type,i.normalize,0,0),this.gl.enableVertexAttribArray(t),this.gl.renderer.vertexAttribDivisor(t,i.divisor)}),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}draw(t){let{program:e,mode:i=this.gl.TRIANGLES}=t;this.gl.renderer.currentGeometry!=="".concat(this.id,"_").concat(e.attributeOrder)&&(this.VAOs[e.attributeOrder]||this.createVAO(e),this.gl.renderer.bindVertexArray(this.VAOs[e.attributeOrder]),this.gl.renderer.currentGeometry="".concat(this.id,"_").concat(e.attributeOrder)),e.attributeLocations.forEach((t,e)=>{const i=this.attributes[e];i.needsUpdate&&this.updateAttribute(i)}),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(i,this.drawRange.count,this.attributes.index.type,this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(i,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(i,this.drawRange.count,this.attributes.index.type,this.drawRange.start):this.gl.drawArrays(i,this.drawRange.start,this.drawRange.count)}computeBoundingBox(t){!t&&this.attributes.position&&(t=this.attributes.position.data),t||console.warn("No position buffer found to compute bounds"),this.bounds||(this.bounds={min:new d,max:new d,center:new d,scale:new d,radius:1/0});const e=this.bounds.min,i=this.bounds.max,r=this.bounds.center,s=this.bounds.scale;e.set(1/0),i.set(-1/0);for(let n=0,a=t.length;n<a;n+=3){const r=t[n],s=t[n+1],a=t[n+2];e.x=Math.min(r,e.x),e.y=Math.min(s,e.y),e.z=Math.min(a,e.z),i.x=Math.max(r,i.x),i.y=Math.max(s,i.y),i.z=Math.max(a,i.z)}s.sub(i,e),r.add(e,i).divide(2)}computeBoundingSphere(t){!t&&this.attributes.position&&(t=this.attributes.position.data),t||console.warn("No position buffer found to compute bounds"),this.bounds||this.computeBoundingBox(t);let e=0;for(let i=0,r=t.length;i<r;i+=3)c.fromArray(t,i),e=Math.max(e,this.bounds.center.squaredDistance(c));this.bounds.radius=Math.sqrt(e)}remove(){this.vao&&this.gl.renderer.deleteVertexArray(this.vao);for(let t in this.attributes)this.gl.deleteBuffer(this.attributes[t].buffer),delete this.attributes[t]}}let f=0;const v={};class x{constructor(t){let{vertex:e,fragment:i,uniforms:r={},transparent:s=!1,cullFace:n=t.BACK,frontFace:a=t.CCW,depthTest:h=!0,depthWrite:o=!0,depthFunc:l=t.LESS}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.uniforms=r,this.id=f++,e||console.warn("vertex shader not supplied"),i||console.warn("fragment shader not supplied"),this.transparent=s,this.cullFace=n,this.frontFace=a,this.depthTest=h,this.depthWrite=o,this.depthFunc=l,this.blendFunc={},this.blendEquation={},this.transparent&&!this.blendFunc.src&&(this.gl.renderer.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));const u=t.createShader(t.VERTEX_SHADER);t.shaderSource(u,e),t.compileShader(u),""!==t.getShaderInfoLog(u)&&console.warn("".concat(t.getShaderInfoLog(u),"\nVertex Shader\n").concat(b(e)));const d=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(d,i),t.compileShader(d),""!==t.getShaderInfoLog(d)&&console.warn("".concat(t.getShaderInfoLog(d),"\nFragment Shader\n").concat(b(i))),this.program=t.createProgram(),t.attachShader(this.program,u),t.attachShader(this.program,d),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))return console.warn(t.getProgramInfoLog(this.program));t.deleteShader(u),t.deleteShader(d),this.uniformLocations=new Map;let c=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS);for(let m=0;m<c;m++){let e=t.getActiveUniform(this.program,m);this.uniformLocations.set(e,t.getUniformLocation(this.program,e.name));const i=e.name.match(/(\w+)/g);e.uniformName=i[0],3===i.length?(e.isStructArray=!0,e.structIndex=Number(i[1]),e.structProperty=i[2]):2===i.length&&isNaN(Number(i[1]))&&(e.isStruct=!0,e.structProperty=i[1])}this.attributeLocations=new Map;const g=[],p=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES);for(let m=0;m<p;m++){const e=t.getActiveAttrib(this.program,m),i=t.getAttribLocation(this.program,e.name);g[i]=e.name,this.attributeLocations.set(e.name,i)}this.attributeOrder=g.join("")}setBlendFunc(t,e,i,r){this.blendFunc.src=t,this.blendFunc.dst=e,this.blendFunc.srcAlpha=i,this.blendFunc.dstAlpha=r,t&&(this.transparent=!0)}setBlendEquation(t,e){this.blendEquation.modeRGB=t,this.blendEquation.modeAlpha=e}applyState(){this.depthTest?this.gl.renderer.enable(this.gl.DEPTH_TEST):this.gl.renderer.disable(this.gl.DEPTH_TEST),this.cullFace?this.gl.renderer.enable(this.gl.CULL_FACE):this.gl.renderer.disable(this.gl.CULL_FACE),this.blendFunc.src?this.gl.renderer.enable(this.gl.BLEND):this.gl.renderer.disable(this.gl.BLEND),this.cullFace&&this.gl.renderer.setCullFace(this.cullFace),this.gl.renderer.setFrontFace(this.frontFace),this.gl.renderer.setDepthMask(this.depthWrite),this.gl.renderer.setDepthFunc(this.depthFunc),this.blendFunc.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.blendEquation.modeRGB&&this.gl.renderer.setBlendEquation(this.blendEquation.modeRGB,this.blendEquation.modeAlpha)}use(){let{flipFaces:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=-1;this.gl.renderer.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.uniformLocations.forEach((t,i)=>{let r=i.uniformName,s=this.uniforms[r];if(i.isStruct&&(s=s[i.structProperty],r+=".".concat(i.structProperty)),i.isStructArray&&(s=s[i.structIndex][i.structProperty],r+="[".concat(i.structIndex,"].").concat(i.structProperty)),!s)return y("Active uniform ".concat(r," has not been supplied"));if(s&&void 0===s.value)return y("".concat(r," uniform is missing a value parameter"));if(s.value.texture)return e+=1,s.value.update(e),w(this.gl,i.type,t,e);if(s.value.length&&s.value[0].texture){const r=[];return s.value.forEach(t=>{e+=1,t.update(e),r.push(e)}),w(this.gl,i.type,t,r)}w(this.gl,i.type,t,s.value)}),this.applyState(),t&&this.gl.renderer.setFrontFace(this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function w(t,e,i,r){r=r.length?function(t){const e=t.length,i=t[0].length;if(void 0===i)return t;const r=e*i;let s=v[r];s||(v[r]=s=new Float32Array(r));for(let n=0;n<e;n++)s.set(t[n],n*i);return s}(r):r;const s=t.renderer.state.uniformLocations.get(i);if(r.length)if(void 0===s)t.renderer.state.uniformLocations.set(i,r.slice(0));else{if(function(t,e){if(t.length!==e.length)return!1;for(let i=0,r=t.length;i<r;i++)if(t[i]!==e[i])return!1;return!0}(s,r))return;s.set?s.set(r):function(t,e){for(let i=0,r=t.length;i<r;i++)t[i]=e[i]}(s,r),t.renderer.state.uniformLocations.set(i,s)}else{if(s===r)return;t.renderer.state.uniformLocations.set(i,r)}switch(e){case 5126:return r.length?t.uniform1fv(i,r):t.uniform1f(i,r);case 35664:return t.uniform2fv(i,r);case 35665:return t.uniform3fv(i,r);case 35666:return t.uniform4fv(i,r);case 35670:case 5124:case 35678:case 35680:return r.length?t.uniform1iv(i,r):t.uniform1i(i,r);case 35671:case 35667:return t.uniform2iv(i,r);case 35672:case 35668:return t.uniform3iv(i,r);case 35673:case 35669:return t.uniform4iv(i,r);case 35674:return t.uniformMatrix2fv(i,!1,r);case 35675:return t.uniformMatrix3fv(i,!1,r);case 35676:return t.uniformMatrix4fv(i,!1,r)}}function b(t){let e=t.split("\n");for(let i=0;i<e.length;i++)e[i]=i+1+": "+e[i];return e.join("\n")}let M=0;function y(t){M>100||(console.warn(t),M++,M>100&&console.warn("More than 100 program warnings - stopping logs."))}const A=new d;function E(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function F(t,e,i,r,s){return t[0]=e,t[1]=i,t[2]=r,t[3]=s,t}function T(t,e){let i=e[0],r=e[1],s=e[2],n=e[3],a=i*i+r*r+s*s+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=i*a,t[1]=r*a,t[2]=s*a,t[3]=n*a,t}function _(t,e,i){let r=e[0],s=e[1],n=e[2],a=e[3],h=i[0],o=i[1],l=i[2],u=i[3];return t[0]=r*u+a*h+s*l-n*o,t[1]=s*u+a*o+n*h-r*l,t[2]=n*u+a*l+r*o-s*h,t[3]=a*u-r*h-s*o-n*l,t}const R=E,S=F,P=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},C=T;class B extends Array{constructor(){return super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1),this.onChange=()=>{},this}get x(){return this[0]}set x(t){this[0]=t,this.onChange()}get y(){return this[1]}set y(t){this[1]=t,this.onChange()}get z(){return this[2]}set z(t){this[2]=t,this.onChange()}get w(){return this[3]}set w(t){this[3]=t,this.onChange()}identity(){var t;return(t=this)[0]=0,t[1]=0,t[2]=0,t[3]=1,this.onChange(),this}set(t,e,i,r){return t.length?this.copy(t):(S(this,t,e,i,r),this.onChange(),this)}rotateX(t){return function(t,e,i){i*=.5;let r=e[0],s=e[1],n=e[2],a=e[3],h=Math.sin(i),o=Math.cos(i);t[0]=r*o+a*h,t[1]=s*o+n*h,t[2]=n*o-s*h,t[3]=a*o-r*h}(this,this,t),this.onChange(),this}rotateY(t){return function(t,e,i){i*=.5;let r=e[0],s=e[1],n=e[2],a=e[3],h=Math.sin(i),o=Math.cos(i);t[0]=r*o-n*h,t[1]=s*o+a*h,t[2]=n*o+r*h,t[3]=a*o-s*h}(this,this,t),this.onChange(),this}rotateZ(t){return function(t,e,i){i*=.5;let r=e[0],s=e[1],n=e[2],a=e[3],h=Math.sin(i),o=Math.cos(i);t[0]=r*o+s*h,t[1]=s*o-r*h,t[2]=n*o+a*h,t[3]=a*o-n*h}(this,this,t),this.onChange(),this}inverse(){return function(t,e){let i=e[0],r=e[1],s=e[2],n=e[3],a=i*i+r*r+s*s+n*n,h=a?1/a:0;t[0]=-i*h,t[1]=-r*h,t[2]=-s*h,t[3]=n*h}(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this),this.onChange(),this}conjugate(){var t,e;return e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,(t=this)[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],this.onChange(),this}copy(t){return R(this,t),this.onChange(),this}normalize(){return C(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this),this.onChange(),this}multiply(t,e){return e?_(this,t,e):_(this,this,t),this.onChange(),this}dot(t){return P(this,t)}fromMatrix3(t){return function(t,e){let i,r=e[0]+e[4]+e[8];if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);let s=(r+1)%3,n=(r+2)%3;i=Math.sqrt(e[3*r+r]-e[3*s+s]-e[3*n+n]+1),t[r]=.5*i,i=.5/i,t[3]=(e[3*s+n]-e[3*n+s])*i,t[s]=(e[3*s+r]+e[3*r+s])*i,t[n]=(e[3*n+r]+e[3*r+n])*i}}(this,t),this.onChange(),this}fromEuler(t){return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"YXZ",r=Math.sin(.5*e[0]),s=Math.cos(.5*e[0]),n=Math.sin(.5*e[1]),a=Math.cos(.5*e[1]),h=Math.sin(.5*e[2]),o=Math.cos(.5*e[2]);"XYZ"===i?(t[0]=r*a*o+s*n*h,t[1]=s*n*o-r*a*h,t[2]=s*a*h+r*n*o,t[3]=s*a*o-r*n*h):"YXZ"===i?(t[0]=r*a*o+s*n*h,t[1]=s*n*o-r*a*h,t[2]=s*a*h-r*n*o,t[3]=s*a*o+r*n*h):"ZXY"===i?(t[0]=r*a*o-s*n*h,t[1]=s*n*o+r*a*h,t[2]=s*a*h+r*n*o,t[3]=s*a*o-r*n*h):"ZYX"===i?(t[0]=r*a*o-s*n*h,t[1]=s*n*o+r*a*h,t[2]=s*a*h-r*n*o,t[3]=s*a*o+r*n*h):"YZX"===i?(t[0]=r*a*o+s*n*h,t[1]=s*n*o+r*a*h,t[2]=s*a*h-r*n*o,t[3]=s*a*o-r*n*h):"XZY"===i&&(t[0]=r*a*o-s*n*h,t[1]=s*n*o-r*a*h,t[2]=s*a*h+r*n*o,t[3]=s*a*o+r*n*h)}(this,t,t.order),this}fromAxisAngle(t,e){return function(t,e,i){i*=.5;let r=Math.sin(i);t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(i)}(this,t,e),this}slerp(t,e){return function(t,e,i,r){let s,n,a,h,o,l=e[0],u=e[1],d=e[2],c=e[3],g=i[0],p=i[1],m=i[2],f=i[3];n=l*g+u*p+d*m+c*f,n<0&&(n=-n,g=-g,p=-p,m=-m,f=-f),1-n>1e-6?(s=Math.acos(n),a=Math.sin(s),h=Math.sin((1-r)*s)/a,o=Math.sin(r*s)/a):(h=1-r,o=r),t[0]=h*l+o*g,t[1]=h*u+o*p,t[2]=h*d+o*m,t[3]=h*c+o*f}(this,this,t,e),this}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}}function L(t,e,i){let r=e[0],s=e[1],n=e[2],a=e[3],h=e[4],o=e[5],l=e[6],u=e[7],d=e[8],c=e[9],g=e[10],p=e[11],m=e[12],f=e[13],v=e[14],x=e[15],w=i[0],b=i[1],M=i[2],y=i[3];return t[0]=w*r+b*h+M*d+y*m,t[1]=w*s+b*o+M*c+y*f,t[2]=w*n+b*l+M*g+y*v,t[3]=w*a+b*u+M*p+y*x,w=i[4],b=i[5],M=i[6],y=i[7],t[4]=w*r+b*h+M*d+y*m,t[5]=w*s+b*o+M*c+y*f,t[6]=w*n+b*l+M*g+y*v,t[7]=w*a+b*u+M*p+y*x,w=i[8],b=i[9],M=i[10],y=i[11],t[8]=w*r+b*h+M*d+y*m,t[9]=w*s+b*o+M*c+y*f,t[10]=w*n+b*l+M*g+y*v,t[11]=w*a+b*u+M*p+y*x,w=i[12],b=i[13],M=i[14],y=i[15],t[12]=w*r+b*h+M*d+y*m,t[13]=w*s+b*o+M*c+y*f,t[14]=w*n+b*l+M*g+y*v,t[15]=w*a+b*u+M*p+y*x,t}class U extends Array{constructor(){return super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,arguments.length>13&&void 0!==arguments[13]?arguments[13]:0,arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,arguments.length>15&&void 0!==arguments[15]?arguments[15]:1),this}set x(t){this[12]=t}get x(){return this[12]}set y(t){this[13]=t}get y(){return this[13]}set z(t){this[14]=t}get z(){return this[14]}set w(t){this[15]=t}get w(){return this[15]}set(t,e,i,r,s,n,a,h,o,l,u,d,c,g,p,m){return t.length?this.copy(t):(function(t,e,i,r,s,n,a,h,o,l,u,d,c,g,p,m,f){t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=a,t[6]=h,t[7]=o,t[8]=l,t[9]=u,t[10]=d,t[11]=c,t[12]=g,t[13]=p,t[14]=m,t[15]=f}(this,t,e,i,r,s,n,a,h,o,l,u,d,c,g,p,m),this)}translate(t){return function(t,e,i){let r,s,n,a,h,o,l,u,d,c,g,p,m=i[0],f=i[1],v=i[2];e===t?(t[12]=e[0]*m+e[4]*f+e[8]*v+e[12],t[13]=e[1]*m+e[5]*f+e[9]*v+e[13],t[14]=e[2]*m+e[6]*f+e[10]*v+e[14],t[15]=e[3]*m+e[7]*f+e[11]*v+e[15]):(r=e[0],s=e[1],n=e[2],a=e[3],h=e[4],o=e[5],l=e[6],u=e[7],d=e[8],c=e[9],g=e[10],p=e[11],t[0]=r,t[1]=s,t[2]=n,t[3]=a,t[4]=h,t[5]=o,t[6]=l,t[7]=u,t[8]=d,t[9]=c,t[10]=g,t[11]=p,t[12]=r*m+h*f+d*v+e[12],t[13]=s*m+o*f+c*v+e[13],t[14]=n*m+l*f+g*v+e[14],t[15]=a*m+u*f+p*v+e[15])}(this,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,t),this}rotateX(t){return function(t,e,i){let r=Math.sin(i),s=Math.cos(i),n=e[4],a=e[5],h=e[6],o=e[7],l=e[8],u=e[9],d=e[10],c=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=n*s+l*r,t[5]=a*s+u*r,t[6]=h*s+d*r,t[7]=o*s+c*r,t[8]=l*s-n*r,t[9]=u*s-a*r,t[10]=d*s-h*r,t[11]=c*s-o*r}(this,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,t),this}rotateY(t){return function(t,e,i){let r=Math.sin(i),s=Math.cos(i),n=e[0],a=e[1],h=e[2],o=e[3],l=e[8],u=e[9],d=e[10],c=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s-l*r,t[1]=a*s-u*r,t[2]=h*s-d*r,t[3]=o*s-c*r,t[8]=n*r+l*s,t[9]=a*r+u*s,t[10]=h*r+d*s,t[11]=o*r+c*s}(this,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,t),this}rotateZ(t){return function(t,e,i){let r=Math.sin(i),s=Math.cos(i),n=e[0],a=e[1],h=e[2],o=e[3],l=e[4],u=e[5],d=e[6],c=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=n*s+l*r,t[1]=a*s+u*r,t[2]=h*s+d*r,t[3]=o*s+c*r,t[4]=l*s-n*r,t[5]=u*s-a*r,t[6]=d*s-h*r,t[7]=c*s-o*r}(this,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,t),this}scale(t){return function(t,e,i){let r=i[0],s=i[1],n=i[2];t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]}(this,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,"number"==typeof t?[t,t,t]:t),this}multiply(t,e){return e?L(this,t,e):L(this,this,t),this}identity(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}copy(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}fromPerspective(){let{fov:t,aspect:e,near:i,far:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,e,i,r,s){let n=1/Math.tan(e/2),a=1/(r-s);t[0]=n/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(s+r)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*s*r*a,t[15]=0}(this,t,e,i,r),this}fromOrthogonal(t){let{left:e,right:i,bottom:r,top:s,near:n,far:a}=t;return function(t,e,i,r,s,n,a){let h=1/(e-i),o=1/(r-s),l=1/(n-a);t[0]=-2*h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+i)*h,t[13]=(s+r)*o,t[14]=(a+n)*l,t[15]=1}(this,e,i,r,s,n,a),this}fromQuaternion(t){return function(t,e){let i=e[0],r=e[1],s=e[2],n=e[3],a=i+i,h=r+r,o=s+s,l=i*a,u=r*a,d=r*h,c=s*a,g=s*h,p=s*o,m=n*a,f=n*h,v=n*o;t[0]=1-d-p,t[1]=u+v,t[2]=c-f,t[3]=0,t[4]=u-v,t[5]=1-l-p,t[6]=g+m,t[7]=0,t[8]=c+f,t[9]=g-m,t[10]=1-l-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this}setPosition(t){return this.x=t[0],this.y=t[1],this.z=t[2],this}inverse(){return function(t,e){let i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],h=e[5],o=e[6],l=e[7],u=e[8],d=e[9],c=e[10],g=e[11],p=e[12],m=e[13],f=e[14],v=e[15],x=i*h-r*a,w=i*o-s*a,b=i*l-n*a,M=r*o-s*h,y=r*l-n*h,A=s*l-n*o,E=u*m-d*p,F=u*f-c*p,T=u*v-g*p,_=d*f-c*m,R=d*v-g*m,S=c*v-g*f,P=x*S-w*R+b*_+M*T-y*F+A*E;P&&(P=1/P,t[0]=(h*S-o*R+l*_)*P,t[1]=(s*R-r*S-n*_)*P,t[2]=(m*A-f*y+v*M)*P,t[3]=(c*y-d*A-g*M)*P,t[4]=(o*T-a*S-l*F)*P,t[5]=(i*S-s*T+n*F)*P,t[6]=(f*b-p*A-v*w)*P,t[7]=(u*A-c*b+g*w)*P,t[8]=(a*R-h*T+l*E)*P,t[9]=(r*T-i*R-n*E)*P,t[10]=(p*y-m*b+v*x)*P,t[11]=(d*b-u*y-g*x)*P,t[12]=(h*F-a*_-o*E)*P,t[13]=(i*_-r*F+s*E)*P,t[14]=(m*w-p*M-f*x)*P,t[15]=(u*M-d*w+c*x)*P)}(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this),this}compose(t,e,i){return function(t,e,i,r){let s=e[0],n=e[1],a=e[2],h=e[3],o=s+s,l=n+n,u=a+a,d=s*o,c=s*l,g=s*u,p=n*l,m=n*u,f=a*u,v=h*o,x=h*l,w=h*u,b=r[0],M=r[1],y=r[2];t[0]=(1-(p+f))*b,t[1]=(c+w)*b,t[2]=(g-x)*b,t[3]=0,t[4]=(c-w)*M,t[5]=(1-(d+f))*M,t[6]=(m+v)*M,t[7]=0,t[8]=(g+x)*y,t[9]=(m-v)*y,t[10]=(1-(d+p))*y,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1}(this,t,e,i),this}getRotation(t){return function(t,e){let i=e[0]+e[5]+e[10],r=0;i>0?(r=2*Math.sqrt(i+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r)}(t,this),this}getTranslation(t){var e,i;return i=this,(e=t)[0]=i[12],e[1]=i[13],e[2]=i[14],this}getScaling(t){return function(t,e){let i=e[0],r=e[1],s=e[2],n=e[4],a=e[5],h=e[6],o=e[8],l=e[9],u=e[10];t[0]=Math.sqrt(i*i+r*r+s*s),t[1]=Math.sqrt(n*n+a*a+h*h),t[2]=Math.sqrt(o*o+l*l+u*u)}(t,this),this}getMaxScaleOnAxis(){return function(t){let e=t[0],i=t[1],r=t[2],s=t[4],n=t[5],a=t[6],h=t[8],o=t[9],l=t[10];const u=e*e+i*i+r*r,d=s*s+n*n+a*a,c=h*h+o*o+l*l;return Math.sqrt(Math.max(u,d,c))}(this)}lookAt(t,e,i){return function(t,e,i,r){let s=e[0],n=e[1],a=e[2],h=r[0],o=r[1],l=r[2],u=s-i[0],d=n-i[1],c=a-i[2],g=u*u+d*d+c*c;g>0&&(g=1/Math.sqrt(g),u*=g,d*=g,c*=g);let p=o*c-l*d,m=l*u-h*c,f=h*d-o*u;g=p*p+m*m+f*f,g>0&&(g=1/Math.sqrt(g),p*=g,m*=g,f*=g),t[0]=p,t[1]=m,t[2]=f,t[3]=0,t[4]=d*f-c*m,t[5]=c*p-u*f,t[6]=u*m-d*p,t[7]=0,t[8]=u,t[9]=d,t[10]=c,t[11]=0,t[12]=s,t[13]=n,t[14]=a,t[15]=1}(this,t,e,i),this}determinant(){return function(t){let e=t[0],i=t[1],r=t[2],s=t[3],n=t[4],a=t[5],h=t[6],o=t[7],l=t[8],u=t[9],d=t[10],c=t[11],g=t[12],p=t[13],m=t[14],f=t[15];return(e*a-i*n)*(d*f-c*m)-(e*h-r*n)*(u*f-c*p)+(e*o-s*n)*(u*m-d*p)+(i*h-r*a)*(l*f-c*g)-(i*o-s*a)*(l*m-d*g)+(r*o-s*h)*(l*p-u*g)}(this)}}const N=new U;class O extends Array{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"YXZ";return super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t),this.order=e,this.onChange=()=>{},this}get x(){return this[0]}set x(t){this[0]=t,this.onChange()}get y(){return this[1]}set y(t){this[1]=t,this.onChange()}get z(){return this[2]}set z(t){this[2]=t,this.onChange()}set(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t;return t.length?this.copy(t):(this[0]=t,this[1]=e,this[2]=i,this.onChange(),this)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.onChange(),this}reorder(t){return this.order=t,this.onChange(),this}fromRotationMatrix(t){return function(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"YXZ";"XYZ"===i?(t[1]=Math.asin(Math.min(Math.max(e[8],-1),1)),Math.abs(e[8])<.99999?(t[0]=Math.atan2(-e[9],e[10]),t[2]=Math.atan2(-e[4],e[0])):(t[0]=Math.atan2(e[6],e[5]),t[2]=0)):"YXZ"===i?(t[0]=Math.asin(-Math.min(Math.max(e[9],-1),1)),Math.abs(e[9])<.99999?(t[1]=Math.atan2(e[8],e[10]),t[2]=Math.atan2(e[1],e[5])):(t[1]=Math.atan2(-e[2],e[0]),t[2]=0)):"ZXY"===i?(t[0]=Math.asin(Math.min(Math.max(e[6],-1),1)),Math.abs(e[6])<.99999?(t[1]=Math.atan2(-e[2],e[10]),t[2]=Math.atan2(-e[4],e[5])):(t[1]=0,t[2]=Math.atan2(e[1],e[0]))):"ZYX"===i?(t[1]=Math.asin(-Math.min(Math.max(e[2],-1),1)),Math.abs(e[2])<.99999?(t[0]=Math.atan2(e[6],e[10]),t[2]=Math.atan2(e[1],e[0])):(t[0]=0,t[2]=Math.atan2(-e[4],e[5]))):"YZX"===i?(t[2]=Math.asin(Math.min(Math.max(e[1],-1),1)),Math.abs(e[1])<.99999?(t[0]=Math.atan2(-e[9],e[5]),t[1]=Math.atan2(-e[2],e[0])):(t[0]=0,t[1]=Math.atan2(e[8],e[10]))):"XZY"===i&&(t[2]=Math.asin(-Math.min(Math.max(e[4],-1),1)),Math.abs(e[4])<.99999?(t[0]=Math.atan2(e[6],e[5]),t[1]=Math.atan2(e[8],e[0])):(t[0]=Math.atan2(-e[9],e[10]),t[1]=0))}(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.order),this}fromQuaternion(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.order;return N.fromQuaternion(t),this.fromRotationMatrix(N,e)}}class D{constructor(){this.parent=null,this.children=[],this.visible=!0,this.matrix=new U,this.worldMatrix=new U,this.matrixAutoUpdate=!0,this.position=new d,this.quaternion=new B,this.scale=new d(1),this.rotation=new O,this.up=new d(0,1,0),this.rotation.onChange=()=>this.quaternion.fromEuler(this.rotation),this.quaternion.onChange=()=>this.rotation.fromQuaternion(this.quaternion)}setParent(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e&&this.parent&&t!==this.parent&&this.parent.removeChild(this,!1),this.parent=t,e&&t&&t.addChild(this,!1)}addChild(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];~this.children.indexOf(t)||this.children.push(t),e&&t.setParent(this,!1)}removeChild(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];~this.children.indexOf(t)&&this.children.splice(this.children.indexOf(t),1),e&&t.setParent(null,!1)}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(null===this.parent?this.worldMatrix.copy(this.matrix):this.worldMatrix.multiply(this.parent.worldMatrix,this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(let e=0,i=this.children.length;e<i;e++)this.children[e].updateMatrixWorld(t)}updateMatrix(){this.matrix.compose(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(t){if(!t(this))for(let e=0,i=this.children.length;e<i;e++)this.children[e].traverse(t)}decompose(){this.matrix.getTranslation(this.position),this.matrix.getRotation(this.quaternion),this.matrix.getScaling(this.scale),this.rotation.fromQuaternion(this.quaternion)}lookAt(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.matrix.lookAt(this.position,t,this.up):this.matrix.lookAt(t,this.position,this.up),this.matrix.getRotation(this.quaternion),this.rotation.fromQuaternion(this.quaternion)}}const z=new U,I=new d,G=new d;class k extends D{constructor(t){let{near:e=.1,far:i=100,fov:r=45,aspect:s=1,left:n,right:a,bottom:h,top:o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t),this.near=e,this.far=i,this.fov=r,this.aspect=s,this.projectionMatrix=new U,this.viewMatrix=new U,this.projectionViewMatrix=new U,n||a?this.orthographic({left:n,right:a,bottom:h,top:o}):this.perspective()}perspective(){let{near:t=this.near,far:e=this.far,fov:i=this.fov,aspect:r=this.aspect}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.projectionMatrix.fromPerspective({fov:i*(Math.PI/180),aspect:r,near:t,far:e}),this.type="perspective",this}orthographic(){let{near:t=this.near,far:e=this.far,left:i=-1,right:r=1,bottom:s=-1,top:n=1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.projectionMatrix.fromOrthogonal({left:i,right:r,bottom:s,top:n,near:t,far:e}),this.type="orthographic",this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix.inverse(this.worldMatrix),this.projectionViewMatrix.multiply(this.projectionMatrix,this.viewMatrix),this}lookAt(t){return super.lookAt(t,!0),this}project(t){return t.applyMatrix4(this.viewMatrix),t.applyMatrix4(this.projectionMatrix),this}unproject(t){return t.applyMatrix4(z.inverse(this.projectionMatrix)),t.applyMatrix4(this.worldMatrix),this}updateFrustum(){this.frustum||(this.frustum=[new d,new d,new d,new d,new d,new d]);const t=this.projectionViewMatrix;this.frustum[0].set(t[3]-t[0],t[7]-t[4],t[11]-t[8]).constant=t[15]-t[12],this.frustum[1].set(t[3]+t[0],t[7]+t[4],t[11]+t[8]).constant=t[15]+t[12],this.frustum[2].set(t[3]+t[1],t[7]+t[5],t[11]+t[9]).constant=t[15]+t[13],this.frustum[3].set(t[3]-t[1],t[7]-t[5],t[11]-t[9]).constant=t[15]-t[13],this.frustum[4].set(t[3]-t[2],t[7]-t[6],t[11]-t[10]).constant=t[15]-t[14],this.frustum[5].set(t[3]+t[2],t[7]+t[6],t[11]+t[10]).constant=t[15]+t[14];for(let e=0;e<6;e++){const t=1/this.frustum[e].distance();this.frustum[e].multiply(t),this.frustum[e].constant*=t}}frustumIntersectsMesh(t){if(!t.geometry.attributes.position)return!0;t.geometry.bounds&&t.geometry.bounds.radius!==1/0||t.geometry.computeBoundingSphere();const e=I;e.copy(t.geometry.bounds.center),e.applyMatrix4(t.worldMatrix);const i=t.geometry.bounds.radius*t.worldMatrix.getMaxScaleOnAxis();return this.frustumIntersectsSphere(e,i)}frustumIntersectsSphere(t,e){const i=G;for(let r=0;r<6;r++){const s=this.frustum[r];if(i.copy(s).dot(t)+s.constant<-e)return!1}return!0}}function q(t,e,i){let r=e[0],s=e[1],n=e[2],a=e[3],h=e[4],o=e[5],l=e[6],u=e[7],d=e[8],c=i[0],g=i[1],p=i[2],m=i[3],f=i[4],v=i[5],x=i[6],w=i[7],b=i[8];return t[0]=c*r+g*a+p*l,t[1]=c*s+g*h+p*u,t[2]=c*n+g*o+p*d,t[3]=m*r+f*a+v*l,t[4]=m*s+f*h+v*u,t[5]=m*n+f*o+v*d,t[6]=x*r+w*a+b*l,t[7]=x*s+w*h+b*u,t[8]=x*n+w*o+b*d,t}class V extends Array{constructor(){return super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:1),this}set(t,e,i,r,s,n,a,h,o){return t.length?this.copy(t):(function(t,e,i,r,s,n,a,h,o,l){t[0]=e,t[1]=i,t[2]=r,t[3]=s,t[4]=n,t[5]=a,t[6]=h,t[7]=o,t[8]=l}(this,t,e,i,r,s,n,a,h,o),this)}translate(t){return function(t,e,i){let r=e[0],s=e[1],n=e[2],a=e[3],h=e[4],o=e[5],l=e[6],u=e[7],d=e[8],c=i[0],g=i[1];t[0]=r,t[1]=s,t[2]=n,t[3]=a,t[4]=h,t[5]=o,t[6]=c*r+g*a+l,t[7]=c*s+g*h+u,t[8]=c*n+g*o+d}(this,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,t),this}rotate(t){return function(t,e,i){let r=e[0],s=e[1],n=e[2],a=e[3],h=e[4],o=e[5],l=e[6],u=e[7],d=e[8],c=Math.sin(i),g=Math.cos(i);t[0]=g*r+c*a,t[1]=g*s+c*h,t[2]=g*n+c*o,t[3]=g*a-c*r,t[4]=g*h-c*s,t[5]=g*o-c*n,t[6]=l,t[7]=u,t[8]=d}(this,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,t),this}scale(t){return function(t,e,i){let r=i[0],s=i[1];t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]}(this,arguments.length>1&&void 0!==arguments[1]?arguments[1]:this,t),this}multiply(t,e){return e?q(this,t,e):q(this,this,t),this}identity(){var t;return(t=this)[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,this}copy(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}fromMatrix4(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[4],e[4]=i[5],e[5]=i[6],e[6]=i[8],e[7]=i[9],e[8]=i[10],this}fromQuaternion(t){return function(t,e){let i=e[0],r=e[1],s=e[2],n=e[3],a=i+i,h=r+r,o=s+s,l=i*a,u=r*a,d=r*h,c=s*a,g=s*h,p=s*o,m=n*a,f=n*h,v=n*o;t[0]=1-d-p,t[3]=u-v,t[6]=c+f,t[1]=u+v,t[4]=1-l-p,t[7]=g-m,t[2]=c-f,t[5]=g+m,t[8]=1-l-d}(this,t),this}fromBasis(t,e,i){return this.set(t[0],t[1],t[2],e[0],e[1],e[2],i[0],i[1],i[2]),this}inverse(){return function(t,e){let i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],h=e[5],o=e[6],l=e[7],u=e[8],d=u*a-h*l,c=-u*n+h*o,g=l*n-a*o,p=i*d+r*c+s*g;p&&(p=1/p,t[0]=d*p,t[1]=(-u*r+s*l)*p,t[2]=(h*r-s*a)*p,t[3]=c*p,t[4]=(u*i-s*o)*p,t[5]=(-h*i+s*n)*p,t[6]=g*p,t[7]=(-l*i+r*o)*p,t[8]=(a*i-r*n)*p)}(this,arguments.length>0&&void 0!==arguments[0]?arguments[0]:this),this}getNormalMatrix(t){return function(t,e){let i=e[0],r=e[1],s=e[2],n=e[3],a=e[4],h=e[5],o=e[6],l=e[7],u=e[8],d=e[9],c=e[10],g=e[11],p=e[12],m=e[13],f=e[14],v=e[15],x=i*h-r*a,w=i*o-s*a,b=i*l-n*a,M=r*o-s*h,y=r*l-n*h,A=s*l-n*o,E=u*m-d*p,F=u*f-c*p,T=u*v-g*p,_=d*f-c*m,R=d*v-g*m,S=c*v-g*f,P=x*S-w*R+b*_+M*T-y*F+A*E;P&&(P=1/P,t[0]=(h*S-o*R+l*_)*P,t[1]=(o*T-a*S-l*F)*P,t[2]=(a*R-h*T+l*E)*P,t[3]=(s*R-r*S-n*_)*P,t[4]=(i*S-s*T+n*F)*P,t[5]=(r*T-i*R-n*E)*P,t[6]=(m*A-f*y+v*M)*P,t[7]=(f*b-p*A-v*w)*P,t[8]=(p*y-m*b+v*x)*P)}(this,t),this}}let Y=0;class X extends D{constructor(t){let{geometry:e,program:i,mode:r=t.TRIANGLES,frustumCulled:s=!0,renderOrder:n=0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t),this.gl=t,this.id=Y++,this.geometry=e,this.program=i,this.mode=r,this.frustumCulled=s,this.renderOrder=n,this.modelViewMatrix=new U,this.normalMatrix=new V,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}onBeforeRender(t){return this.beforeRenderCallbacks.push(t),this}onAfterRender(t){return this.afterRenderCallbacks.push(t),this}draw(){let{camera:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.beforeRenderCallbacks.forEach(e=>e&&e({mesh:this,camera:t})),t&&(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{modelMatrix:{value:null},viewMatrix:{value:null},modelViewMatrix:{value:null},normalMatrix:{value:null},projectionMatrix:{value:null},cameraPosition:{value:null}}),this.program.uniforms.projectionMatrix.value=t.projectionMatrix,this.program.uniforms.cameraPosition.value=t.position,this.program.uniforms.viewMatrix.value=t.viewMatrix,this.modelViewMatrix.multiply(t.viewMatrix,this.worldMatrix),this.normalMatrix.getNormalMatrix(this.modelViewMatrix),this.program.uniforms.modelMatrix.value=this.worldMatrix,this.program.uniforms.modelViewMatrix.value=this.modelViewMatrix,this.program.uniforms.normalMatrix.value=this.normalMatrix);let e=this.program.cullFace&&this.worldMatrix.determinant()<0;this.program.use({flipFaces:e}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach(e=>e&&e({mesh:this,camera:t}))}}const j=new Uint8Array(4);function W(t){return 0==(t&t-1)}let H=0;class Z{constructor(t){let{image:e,target:i=t.TEXTURE_2D,type:r=t.UNSIGNED_BYTE,format:s=t.RGBA,internalFormat:n=s,wrapS:a=t.CLAMP_TO_EDGE,wrapT:h=t.CLAMP_TO_EDGE,generateMipmaps:o=!0,minFilter:l=(o?t.NEAREST_MIPMAP_LINEAR:t.LINEAR),magFilter:u=t.LINEAR,premultiplyAlpha:d=!1,unpackAlignment:c=4,flipY:g=i==t.TEXTURE_2D,level:p=0,width:m,height:f=m}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.id=H++,this.image=e,this.target=i,this.type=r,this.format=s,this.internalFormat=n,this.minFilter=l,this.magFilter=u,this.wrapS=a,this.wrapT=h,this.generateMipmaps=o,this.premultiplyAlpha=d,this.unpackAlignment=c,this.flipY=g,this.level=p,this.width=m,this.height=f,this.texture=this.gl.createTexture(),this.store={image:null},this.glState=this.gl.renderer.state,this.state={},this.state.minFilter=this.gl.NEAREST_MIPMAP_LINEAR,this.state.magFilter=this.gl.LINEAR,this.state.wrapS=this.gl.REPEAT,this.state.wrapT=this.gl.REPEAT}bind(){this.glState.textureUnits[this.glState.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.glState.textureUnits[this.glState.activeTextureUnit]=this.id)}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const e=!(this.image===this.store.image&&!this.needsUpdate);if((e||this.glState.textureUnits[t]!==this.id)&&(this.gl.renderer.activeTexture(t),this.bind()),e){if(this.needsUpdate=!1,this.flipY!==this.glState.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.glState.flipY=this.flipY),this.premultiplyAlpha!==this.glState.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.glState.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.glState.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.glState.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.image){if(this.image.width&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP)for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,this.level,this.internalFormat,this.format,this.type,this.image[t]);else ArrayBuffer.isView(this.image)?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image):this.gl.texImage2D(this.target,this.level,this.internalFormat,this.format,this.type,this.image);this.generateMipmaps&&(this.gl.renderer.isWebgl2||W(this.image.width)&&W(this.image.height)?this.gl.generateMipmap(this.target):(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR))}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,j);else this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,j);this.store.image=this.image,this.onUpdate&&this.onUpdate()}}}class Q{constructor(t){let{width:e=t.canvas.width,height:i=t.canvas.height,target:r=t.FRAMEBUFFER,color:s=1,depth:n=!0,stencil:a=!1,depthTexture:h=!1,wrapS:o=t.CLAMP_TO_EDGE,wrapT:l=t.CLAMP_TO_EDGE,minFilter:u=t.LINEAR,magFilter:d=u,type:c=t.UNSIGNED_BYTE,format:g=t.RGBA,internalFormat:p=g,unpackAlignment:m,premultiplyAlpha:f}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.width=e,this.height=i,this.depth=n,this.buffer=this.gl.createFramebuffer(),this.target=r,this.gl.bindFramebuffer(this.target,this.buffer),this.textures=[];const v=[];for(let x=0;x<s;x++)this.textures.push(new Z(t,{width:e,height:i,wrapS:o,wrapT:l,minFilter:u,magFilter:d,type:c,format:g,internalFormat:p,unpackAlignment:m,premultiplyAlpha:f,flipY:!1,generateMipmaps:!1})),this.textures[x].update(),this.gl.framebufferTexture2D(this.target,this.gl.COLOR_ATTACHMENT0+x,this.gl.TEXTURE_2D,this.textures[x].texture,0),v.push(this.gl.COLOR_ATTACHMENT0+x);v.length>1&&this.gl.renderer.drawBuffers(v),this.texture=this.textures[0],h&&(this.gl.renderer.isWebgl2||this.gl.renderer.getExtension("WEBGL_depth_texture"))?(this.depthTexture=new Z(t,{width:e,height:i,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,format:this.gl.DEPTH_COMPONENT,internalFormat:t.renderer.isWebgl2?this.gl.DEPTH_COMPONENT16:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT}),this.depthTexture.update(),this.gl.framebufferTexture2D(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)):(n&&!a&&(this.depthBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,e,i),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,this.depthBuffer)),a&&!n&&(this.stencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.stencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.STENCIL_INDEX8,e,i),this.gl.framebufferRenderbuffer(this.target,this.gl.STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.stencilBuffer)),n&&a&&(this.depthStencilBuffer=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.depthStencilBuffer),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_STENCIL,e,i),this.gl.framebufferRenderbuffer(this.target,this.gl.DEPTH_STENCIL_ATTACHMENT,this.gl.RENDERBUFFER,this.depthStencilBuffer))),this.gl.bindFramebuffer(this.target,null)}}function K(t){4===t.length&&(t=t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]);const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e||console.warn("Unable to convert hex string ".concat(t," to rgb values")),[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255]}class J extends Array{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return"string"==typeof t&&([t,e,i]=K(t)),super(t,e,i),this}get r(){return this[0]}set r(t){this[0]=t}get g(){return this[1]}set g(t){this[1]=t}get b(){return this[2]}set b(t){this[2]=t}set(t,e,i){return"string"==typeof t&&([t,e,i]=K(t)),t.length?this.copy(t):(this[0]=t,this[1]=e,this[2]=i,this)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this}}function $(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t}function tt(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function et(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t}function it(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)}class rt extends Array{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:t),this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}set(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return t.length?this.copy(t):(function(t,e,i){t[0]=e,t[1]=i}(this,t,e),this)}copy(t){var e,i;return i=t,(e=this)[0]=i[0],e[1]=i[1],this}add(t,e){return e?$(this,t,e):$(this,this,t),this}sub(t,e){return e?tt(this,t,e):tt(this,this,t),this}multiply(t){var e,i,r;return t.length?(i=this,r=t,(e=this)[0]=i[0]*r[0],e[1]=i[1]*r[1]):et(this,this,t),this}divide(t){var e,i,r;return t.length?(i=this,r=t,(e=this)[0]=i[0]/r[0],e[1]=i[1]/r[1]):et(this,this,1/t),this}inverse(){var t,e;return e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,(t=this)[0]=1/e[0],t[1]=1/e[1],this}len(){return it(this)}distance(t){return t?(e=this,r=(i=t)[0]-e[0],s=i[1]-e[1],Math.sqrt(r*r+s*s)):it(this);var e,i,r,s}squaredLen(){return this.squaredDistance()}squaredDistance(t){return t?(e=this,r=(i=t)[0]-e[0],s=i[1]-e[1],r*r+s*s):function(t){var e=t[0],i=t[1];return e*e+i*i}(this);var e,i,r,s}negate(){var t,e;return e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,(t=this)[0]=-e[0],t[1]=-e[1],this}cross(t,e){return r=e,(i=t)[0]*r[1]-i[1]*r[0];var i,r}scale(t){return et(this,this,t),this}normalize(){var t,e,i,r,s;return t=this,i=(e=this)[0],r=e[1],(s=i*i+r*r)>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,this}dot(t){return i=t,(e=this)[0]*i[0]+e[1]*i[1];var e,i}equals(t){return i=t,(e=this)[0]===i[0]&&e[1]===i[1];var e,i}applyMatrix3(t){var e,i,r,s,n;return e=this,r=t,s=(i=this)[0],n=i[1],e[0]=r[0]*s+r[3]*n+r[6],e[1]=r[1]*s+r[4]*n+r[7],this}applyMatrix4(t){return function(t,e,i){let r=e[0],s=e[1];t[0]=i[0]*r+i[4]*s+i[12],t[1]=i[1]*r+i[5]*s+i[13]}(this,this,t),this}lerp(t,e){!function(t,e,i,r){var s=e[0],n=e[1];t[0]=s+r*(i[0]-s),t[1]=n+r*(i[1]-n)}(this,this,t,e)}clone(){return new rt(this[0],this[1])}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this[0]=t[e],this[1]=t[e+1],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this[0],t[e+1]=this[1],t}}class st extends m{constructor(t){let{width:e=1,height:i=1,widthSegments:r=1,heightSegments:s=1,attributes:n={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a=r,h=s,o=(a+1)*(h+1),l=a*h*6,u=new Float32Array(3*o),d=new Float32Array(3*o),c=new Float32Array(2*o),g=o>65536?new Uint32Array(l):new Uint16Array(l);st.buildPlane(u,d,c,g,e,i,0,a,h),Object.assign(n,{position:{size:3,data:u},normal:{size:3,data:d},uv:{size:2,data:c},index:{data:g}}),super(t,n)}static buildPlane(t,e,i,r,s,n,a,h,o){let l=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1,d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:2,c=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,g=arguments.length>13&&void 0!==arguments[13]?arguments[13]:-1,p=arguments.length>14&&void 0!==arguments[14]?arguments[14]:0,m=arguments.length>15&&void 0!==arguments[15]?arguments[15]:0;const f=p,v=s/h,x=n/o;for(let w=0;w<=o;w++){let b=w*x-n/2;for(let n=0;n<=h;n++,p++){let x=n*v-s/2;if(t[3*p+l]=x*c,t[3*p+u]=b*g,t[3*p+d]=a/2,e[3*p+l]=0,e[3*p+u]=0,e[3*p+d]=a>=0?1:-1,i[2*p]=n/h,i[2*p+1]=1-w/o,w===o||n===h)continue;let M=f+n+w*(h+1),y=f+n+(w+1)*(h+1),A=f+n+(w+1)*(h+1)+1,E=f+n+w*(h+1)+1;r[6*m]=M,r[6*m+1]=y,r[6*m+2]=E,r[6*m+3]=y,r[6*m+4]=A,r[6*m+5]=E,m++}}}}const nt=-1,at=0,ht=1,ot=2,lt=3,ut=new d,dt=new rt,ct=new rt;const gt=new d,pt=new d,mt=new d,ft=new U;const vt="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",xt="\n    precision highp float;\n\n    uniform sampler2D tMap;\n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor = texture2D(tMap, vUv);\n    }\n",wt=new d,bt=new B,Mt=new d,yt=new d,At=new B,Et=new d;class Ft{constructor(t){let{objects:e,data:i}=t;this.objects=e,this.data=i,this.elapsed=0,this.weight=1,this.duration=i.frames.length-1}update(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const e=(arguments.length>1?arguments[1]:void 0)?1:this.weight/t,i=this.elapsed%this.duration,r=Math.floor(i),s=i-r,n=this.data.frames[r],a=this.data.frames[(r+1)%this.duration];this.objects.forEach((t,i)=>{wt.fromArray(n.position,3*i),bt.fromArray(n.quaternion,4*i),Mt.fromArray(n.scale,3*i),yt.fromArray(a.position,3*i),At.fromArray(a.quaternion,4*i),Et.fromArray(a.scale,3*i),wt.lerp(yt,s),bt.slerp(At,s),Mt.lerp(Et,s),t.position.lerp(wt,e),t.quaternion.slerp(bt,e),t.scale.lerp(Mt,e)})}}const Tt=new U;const _t="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",Rt="\n    precision highp float;\n\n    uniform sampler2D tMap;\n\n    uniform float uFalloff;\n    uniform float uAlpha;\n    uniform float uDissipation;\n    \n    uniform float uAspect;\n    uniform vec2 uMouse;\n    uniform vec2 uVelocity;\n\n    varying vec2 vUv;\n\n    void main() {\n        vec4 color = texture2D(tMap, vUv) * uDissipation;\n\n        vec2 cursor = vUv - uMouse;\n        cursor.x *= uAspect;\n\n        vec3 stamp = vec3(uVelocity * vec2(1, -1), 1.0 - pow(1.0 - min(1.0, length(uVelocity)), 3.0));\n        float falloff = smoothstep(uFalloff, 0.0, length(cursor)) * uAlpha;\n\n        color.rgb = mix(color.rgb, stamp, vec3(falloff));\n\n        gl_FragColor = color;\n    }\n";const St="\n    attribute vec2 uv;\n    attribute vec2 position;\n\n    varying vec2 vUv;\n\n    void main() {\n        vUv = uv;\n        gl_Position = vec4(position, 0, 1);\n    }\n",Pt="\n    precision highp float;\n\n    uniform sampler2D tMap;\n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor = texture2D(tMap, vUv);\n    }\n",Ct=new d;const Bt="\n    precision highp float;\n\n    attribute vec3 position;\n    attribute vec3 next;\n    attribute vec3 prev;\n    attribute vec2 uv;\n    attribute float side;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n    uniform vec2 uResolution;\n    uniform float uDPR;\n    uniform float uThickness;\n    uniform float uMiter;\n\n    varying vec2 vUv;\n\n    vec4 getPosition() {\n        mat4 mvp = projectionMatrix * modelViewMatrix;\n        vec4 current = mvp * vec4(position, 1);\n        vec4 nextPos = mvp * vec4(next, 1);\n        vec4 prevPos = mvp * vec4(prev, 1);\n\n        vec2 aspect = vec2(uResolution.x / uResolution.y, 1);    \n        vec2 currentScreen = current.xy / current.w * aspect;\n        vec2 nextScreen = nextPos.xy / nextPos.w * aspect;\n        vec2 prevScreen = prevPos.xy / prevPos.w * aspect;\n    \n        vec2 dir1 = normalize(currentScreen - prevScreen);\n        vec2 dir2 = normalize(nextScreen - currentScreen);\n        vec2 dir = normalize(dir1 + dir2);\n    \n        vec2 normal = vec2(-dir.y, dir.x);\n        normal /= mix(1.0, max(0.3, dot(normal, vec2(-dir1.y, dir1.x))), uMiter);\n        normal /= aspect;\n\n        float pixelWidthRatio = 1.0 / (uResolution.y / uDPR);\n        float pixelWidth = current.w * pixelWidthRatio;\n        normal *= pixelWidth * uThickness;\n        current.xy -= normal * side;\n    \n        return current;\n    }\n\n    void main() {\n        vUv = uv;\n        gl_Position = getPosition();\n    }\n",Lt="\n    precision highp float;\n\n    uniform vec3 uColor;\n    \n    varying vec2 vUv;\n\n    void main() {\n        gl_FragColor.rgb = uColor;\n        gl_FragColor.a = 1.0;\n    }\n";const Ut="\n    attribute vec3 position;\n    attribute vec2 uv;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n",Nt="\n    precision highp float;\n\n    vec4 packRGBA (float v) {\n        vec4 pack = fract(vec4(1.0, 255.0, 65025.0, 16581375.0) * v);\n        pack -= pack.yzww * vec2(1.0 / 255.0, 0.0).xxxy;\n        return pack;\n    }\n\n    void main() {\n        gl_FragColor = packRGBA(gl_FragCoord.z);\n    }\n";e.Animation=Ft,e.Box=class extends m{constructor(t){let{width:e=1,height:i=1,depth:r=1,widthSegments:s=1,heightSegments:n=1,depthSegments:a=1,attributes:h={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=s,l=n,u=a,d=(o+1)*(l+1)*2+(o+1)*(u+1)*2+(l+1)*(u+1)*2,c=6*(o*l*2+o*u*2+l*u*2),g=new Float32Array(3*d),p=new Float32Array(3*d),m=new Float32Array(2*d),f=d>65536?new Uint32Array(c):new Uint16Array(c);let v=0,x=0;st.buildPlane(g,p,m,f,r,i,e,u,l,2,1,0,-1,-1,v,x),st.buildPlane(g,p,m,f,r,i,-e,u,l,2,1,0,1,-1,v+=(u+1)*(l+1),x+=u*l),st.buildPlane(g,p,m,f,e,r,i,u,l,0,2,1,1,1,v+=(u+1)*(l+1),x+=u*l),st.buildPlane(g,p,m,f,e,r,-i,u,l,0,2,1,1,-1,v+=(o+1)*(u+1),x+=o*u),st.buildPlane(g,p,m,f,e,i,-r,o,l,0,1,2,-1,-1,v+=(o+1)*(u+1),x+=o*u),st.buildPlane(g,p,m,f,e,i,r,o,l,0,1,2,1,-1,v+=(o+1)*(l+1),x+=o*l),Object.assign(h,{position:{size:3,data:g},normal:{size:3,data:p},uv:{size:2,data:m},index:{data:f}}),super(t,h)}},e.Camera=k,e.Color=J,e.Cylinder=class extends m{constructor(t){let{radiusTop:e=.5,radiusBottom:i=.5,height:r=1,radialSegments:s=8,heightSegments:n=1,openEnded:a=!1,thetaStart:h=0,thetaLength:o=2*Math.PI,attributes:l={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const u=s,c=n,g=h,p=o,m=a?0:i&&e?2:1,f=(u+1)*(c+1+m)+m,v=u*c*6+m*u*3,x=new Float32Array(3*f),w=new Float32Array(3*f),b=new Float32Array(2*f),M=f>65536?new Uint32Array(v):new Uint16Array(v);let y=0,A=0;const E=[];function F(t){let s;const n=!0===t?e:i,a=!0===t?1:-1,h=y;for(x.set([0,.5*r*a,0],3*y),w.set([0,a,0],3*y),b.set([.5,.5],2*y),y++,s=0;s<=u;s++){const t=s/u*p+g,e=Math.cos(t),i=Math.sin(t);x.set([n*i,.5*r*a,n*e],3*y),w.set([0,a,0],3*y),b.set([.5*e+.5,.5*i*a+.5],2*y),y++}for(s=0;s<u;s++){const e=h+s+1;t?M.set([e,e+1,h],3*A):M.set([e+1,e,h],3*A),A++}}!function(){let t,s;const n=new d,a=(i-e)/r;for(s=0;s<=c;s++){const h=[],o=s/c,l=o*(i-e)+e;for(t=0;t<=u;t++){const e=t/u,i=e*p+g,s=Math.sin(i),d=Math.cos(i);x.set([l*s,(.5-o)*r,l*d],3*y),n.set(s,a,d).normalize(),w.set([n.x,n.y,n.z],3*y),b.set([e,1-o],2*y),h.push(y++)}E.push(h)}for(t=0;t<u;t++)for(s=0;s<c;s++){const e=E[s][t],i=E[s+1][t],r=E[s+1][t+1],n=E[s][t+1];M.set([e,i,n,i,r,n],3*A),A+=2}}(),a||(e&&F(!0),i&&F(!1)),Object.assign(l,{position:{size:3,data:x},normal:{size:3,data:w},uv:{size:2,data:b},index:{data:M}}),super(t,l)}},e.Euler=O,e.Flowmap=class{constructor(t){let{size:e=128,falloff:i=.3,alpha:r=1,dissipation:s=.98}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this;this.gl=t,this.uniform={value:null},this.mask={read:null,write:null,swap:()=>{let t=n.mask.read;n.mask.read=n.mask.write,n.mask.write=t,n.uniform.value=n.mask.read.texture}},function(){let i=t.renderer.extensions["OES_texture_".concat(t.renderer.isWebgl2?"":"half_","float_linear")];const r={width:e,height:e,type:t.renderer.isWebgl2?t.HALF_FLOAT:t.renderer.extensions.OES_texture_half_float?t.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES:t.UNSIGNED_BYTE,format:t.RGBA,internalFormat:t.renderer.isWebgl2?t.RGBA16F:t.RGBA,minFilter:i?t.LINEAR:t.NEAREST,depth:!1};n.mask.read=new Q(t,r),n.mask.write=new Q(t,r),n.mask.swap()}(),this.aspect=1,this.mouse=new rt,this.velocity=new rt,this.mesh=new X(t,{geometry:new m(t,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}}),program:new x(t,{vertex:_t,fragment:Rt,uniforms:{tMap:n.uniform,uFalloff:{value:.5*i},uAlpha:{value:r},uDissipation:{value:s},uAspect:{value:1},uMouse:{value:n.mouse},uVelocity:{value:n.velocity}},depthTest:!1})})}update(){this.mesh.program.uniforms.uAspect.value=this.aspect,this.gl.renderer.render({scene:this.mesh,target:this.mask.write,clear:!1}),this.mask.swap()}},e.GPGPU=class{constructor(t,e){let{data:i=new Float32Array(16),geometry:r=new m(t,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}})}=e;this.gl=t;const s=i;this.passes=[],this.geometry=r,this.dataLength=s.length/4,this.size=Math.pow(2,Math.ceil(Math.log(Math.ceil(Math.sqrt(this.dataLength)))/Math.LN2)),this.coords=new Float32Array(2*this.dataLength);for(let h=0;h<this.dataLength;h++){const t=h%this.size/this.size,e=Math.floor(h/this.size)/this.size;this.coords.set([t,e],2*h)}const n=(()=>{if(s.length===this.size*this.size*4)return s;{const t=new Float32Array(this.size*this.size*4);return t.set(s),t}})();this.uniform={value:new Z(t,{image:n,target:t.TEXTURE_2D,type:t.FLOAT,format:t.RGBA,internalFormat:t.renderer.isWebgl2?t.RGBA32F:t.RGBA,wrapS:t.CLAMP_TO_EDGE,wrapT:t.CLAMP_TO_EDGE,generateMipmaps:!1,minFilter:t.NEAREST,magFilter:t.NEAREST,width:this.size,flipY:!1})};const a={width:this.size,height:this.size,type:t.renderer.isWebgl2?t.HALF_FLOAT:t.renderer.extensions.OES_texture_half_float?t.renderer.extensions.OES_texture_half_float.HALF_FLOAT_OES:t.UNSIGNED_BYTE,format:t.RGBA,internalFormat:t.renderer.isWebgl2?t.RGBA16F:t.RGBA,minFilter:t.NEAREST,depth:!1,unpackAlignment:1};this.fbo={read:new Q(t,a),write:new Q(t,a),swap:()=>{let t=this.fbo.read;this.fbo.read=this.fbo.write,this.fbo.write=t,this.uniform.value=this.fbo.read.texture}}}addPass(){let{vertex:t=St,fragment:e=Pt,uniforms:i={},textureUniform:r="tMap",enabled:s=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i[r]=this.uniform;const n=new x(this.gl,{vertex:t,fragment:e,uniforms:i}),a={mesh:new X(this.gl,{geometry:this.geometry,program:n}),program:n,uniforms:i,enabled:s,textureUniform:r};return this.passes.push(a),a}render(){this.passes.filter(t=>t.enabled).forEach((t,e)=>{this.gl.renderer.render({scene:t.mesh,target:this.fbo.write,clear:!1}),this.fbo.swap()})}},e.Geometry=m,e.Mat3=V,e.Mat4=U,e.Mesh=X,e.NormalProgram=function(t){return new x(t,{vertex:"\n    precision highp float;\n    precision highp int;\n\n    attribute vec3 position;\n    attribute vec3 normal;\n\n    uniform mat3 normalMatrix;\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    varying vec3 vNormal;\n\n    void main() {\n        vNormal = normalize(normalMatrix * normal);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    }\n",fragment:"\n    precision highp float;\n    precision highp int;\n\n    varying vec3 vNormal;\n\n    void main() {\n        gl_FragColor.rgb = normalize(vNormal);\n        gl_FragColor.a = 1.0;\n    }\n"})},e.Orbit=function(t){let{element:e=document,enabled:i=!0,target:r=new d,ease:s=.25,inertia:n=.85,enableRotate:a=!0,rotateSpeed:h=.1,enableZoom:o=!0,zoomSpeed:l=1,enablePan:u=!0,panSpeed:c=.1,minPolarAngle:g=0,maxPolarAngle:p=Math.PI,minAzimuthAngle:m=-1/0,maxAzimuthAngle:f=1/0,minDistance:v=0,maxDistance:x=1/0}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.enabled=i,this.target=r,s=s||1,n=n||1,this.minDistance=v,this.maxDistance=x;const w={radius:1,phi:0,theta:0},b={radius:1,phi:0,theta:0},M={radius:1,phi:0,theta:0},y=new d,A=new d;A.copy(t.position).sub(this.target),M.radius=b.radius=A.distance(),M.theta=b.theta=Math.atan2(A.x,A.z),M.phi=b.phi=Math.acos(Math.min(Math.max(A.y/b.radius,-1),1)),this.update=()=>{b.radius*=w.radius,b.theta+=w.theta,b.phi+=w.phi,b.theta=Math.max(m,Math.min(f,b.theta)),b.phi=Math.max(g,Math.min(p,b.phi)),b.radius=Math.max(this.minDistance,Math.min(this.maxDistance,b.radius)),M.phi+=(b.phi-M.phi)*s,M.theta+=(b.theta-M.theta)*s,M.radius+=(b.radius-M.radius)*s,this.target.add(y);let e=M.radius*Math.sin(Math.max(1e-6,M.phi));A.x=e*Math.sin(M.theta),A.y=M.radius*Math.cos(M.phi),A.z=e*Math.cos(M.theta),t.position.copy(this.target).add(A),t.lookAt(this.target),w.theta*=n,w.phi*=n,y.multiply(n),w.radius=1};const E=new rt,F=new rt,T=new rt;let _=nt;function R(){return Math.pow(.95,l)}function S(t,e){ut.set(e[0],e[1],e[2]),ut.multiply(-t),y.add(ut)}function P(t,e){ut.set(e[4],e[5],e[6]),ut.multiply(t),y.add(ut)}this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2};const C=(i,r)=>{let s=e===document?document.body:e;ut.copy(t.position).sub(this.target);let n=ut.distance();n*=Math.tan((t.fov||45)/2*Math.PI/180),S(2*i*n/s.clientHeight,t.matrix),P(2*r*n/s.clientHeight,t.matrix)};function B(t){w.radius/=t}function L(t,i){dt.set(t,i),ct.sub(dt,E).multiply(h);let r=e===document?document.body:e;w.theta-=2*Math.PI*ct.x/r.clientHeight,w.phi-=2*Math.PI*ct.y/r.clientHeight,E.copy(dt)}function U(t){dt.set(t.clientX,t.clientY),ct.sub(dt,T),ct.y>0?B(R()):ct.y<0&&B(1/R()),T.copy(dt)}function N(t,e){dt.set(t,e),ct.sub(dt,F).multiply(c),C(ct.x,ct.y),F.copy(dt)}function O(t){if(o){let e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(e*e+i*i);T.set(0,r)}if(u){let e=.5*(t.touches[0].pageX+t.touches[1].pageX),i=.5*(t.touches[0].pageY+t.touches[1].pageY);F.set(e,i)}}function D(t){if(o){let e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY,r=Math.sqrt(e*e+i*i);dt.set(0,r),ct.set(0,Math.pow(dt.y/T.y,l)),B(ct.y),T.copy(dt)}if(u){N(.5*(t.touches[0].pageX+t.touches[1].pageX),.5*(t.touches[0].pageY+t.touches[1].pageY))}}const z=t=>{if(this.enabled){switch(t.button){case this.mouseButtons.ORBIT:if(!1===a)return;E.set(t.clientX,t.clientY),_=at;break;case this.mouseButtons.ZOOM:if(!1===o)return;T.set(t.clientX,t.clientY),_=ht;break;case this.mouseButtons.PAN:if(!1===u)return;F.set(t.clientX,t.clientY),_=ot}_!==nt&&(window.addEventListener("mousemove",I,!1),window.addEventListener("mouseup",G,!1))}},I=t=>{if(this.enabled)switch(_){case at:if(!1===a)return;L(t.clientX,t.clientY);break;case ht:if(!1===o)return;U(t);break;case ot:if(!1===u)return;N(t.clientX,t.clientY)}},G=()=>{this.enabled&&(document.removeEventListener("mousemove",I,!1),document.removeEventListener("mouseup",G,!1),_=nt)},k=t=>{this.enabled&&o&&(_===nt||_===at)&&(t.stopPropagation(),t.deltaY<0?B(1/R()):t.deltaY>0&&B(R()))},q=t=>{if(this.enabled)switch(t.preventDefault(),t.touches.length){case 1:if(!1===a)return;E.set(t.touches[0].pageX,t.touches[0].pageY),_=at;break;case 2:if(!1===o&&!1===u)return;O(t),_=lt;break;default:_=nt}},V=t=>{if(this.enabled)switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(!1===a)return;L(t.touches[0].pageX,t.touches[0].pageY);break;case 2:if(!1===o&&!1===u)return;D(t);break;default:_=nt}},Y=()=>{this.enabled&&(_=nt)},X=t=>{this.enabled&&t.preventDefault()};function j(){e.addEventListener("contextmenu",X,!1),e.addEventListener("mousedown",z,!1),window.addEventListener("wheel",k,!1),e.addEventListener("touchstart",q,{passive:!1}),e.addEventListener("touchend",Y,!1),e.addEventListener("touchmove",V,{passive:!1})}this.remove=function(){e.removeEventListener("contextmenu",X,!1),e.removeEventListener("mousedown",z,!1),window.removeEventListener("wheel",k,!1),e.removeEventListener("touchstart",q,!1),e.removeEventListener("touchend",Y,!1),e.removeEventListener("touchmove",V,!1),window.removeEventListener("mousemove",I,!1),window.removeEventListener("mouseup",G,!1)},j()},e.Plane=st,e.Polyline=class{constructor(t,e){let{points:i,vertex:r=Bt,fragment:s=Lt,uniforms:n={},attributes:a={}}=e;this.gl=t,this.points=i,this.count=i.length,this.position=new Float32Array(3*this.count*2),this.prev=new Float32Array(3*this.count*2),this.next=new Float32Array(3*this.count*2);const h=new Float32Array(1*this.count*2),o=new Float32Array(2*this.count*2),l=new Uint16Array(3*(this.count-1)*2);for(let c=0;c<this.count;c++){h.set([-1,1],2*c);const t=c/(this.count-1);if(o.set([0,t,1,t],4*c),c===this.count-1)continue;const e=2*c;l.set([e+0,e+1,e+2],3*(e+0)),l.set([e+2,e+1,e+3],3*(e+1))}const u=this.geometry=new m(t,Object.assign(a,{position:{size:3,data:this.position},prev:{size:3,data:this.prev},next:{size:3,data:this.next},side:{size:1,data:h},uv:{size:2,data:o},index:{size:1,data:l}}));this.updateGeometry(),n.uResolution||(this.resolution=n.uResolution={value:new rt}),n.uDPR||(this.dpr=n.uDPR={value:1}),n.uThickness||(this.thickness=n.uThickness={value:1}),n.uColor||(this.color=n.uColor={value:new J("#000")}),n.uMiter||(this.miter=n.uMiter={value:1}),this.resize();const d=this.program=new x(t,{vertex:r,fragment:s,uniforms:n});this.mesh=new X(t,{geometry:u,program:d})}updateGeometry(){this.points.forEach((t,e)=>{t.toArray(this.position,3*e*2),t.toArray(this.position,3*e*2+3),e?(t.toArray(this.next,3*(e-1)*2),t.toArray(this.next,3*(e-1)*2+3)):(Ct.copy(t).sub(this.points[e+1]).add(t),Ct.toArray(this.prev,3*e*2),Ct.toArray(this.prev,3*e*2+3)),e===this.points.length-1?(Ct.copy(t).sub(this.points[e-1]).add(t),Ct.toArray(this.next,3*e*2),Ct.toArray(this.next,3*e*2+3)):(t.toArray(this.prev,3*(e+1)*2),t.toArray(this.prev,3*(e+1)*2+3))}),this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.prev.needsUpdate=!0,this.geometry.attributes.next.needsUpdate=!0}resize(){this.resolution&&this.resolution.value.set(this.gl.canvas.width,this.gl.canvas.height),this.dpr&&(this.dpr.value=this.gl.renderer.dpr)}},e.Post=class{constructor(t){let{width:e,height:i,dpr:r,wrapS:s=t.CLAMP_TO_EDGE,wrapT:n=t.CLAMP_TO_EDGE,minFilter:a=t.LINEAR,magFilter:h=t.LINEAR,geometry:o=new m(t,{position:{size:2,data:new Float32Array([-1,-1,3,-1,-1,3])},uv:{size:2,data:new Float32Array([0,0,2,0,0,2])}})}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.gl=t,this.options={wrapS:s,wrapT:n,minFilter:a,magFilter:h},this.passes=[],this.geometry=o;const l=this.fbo={read:null,write:null,swap:()=>{let t=l.read;l.read=l.write,l.write=t}};this.resize({width:e,height:i,dpr:r})}addPass(){let{vertex:t=vt,fragment:e=xt,uniforms:i={},textureUniform:r="tMap",enabled:s=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i[r]={value:this.fbo.read.texture};const n=new x(this.gl,{vertex:t,fragment:e,uniforms:i}),a={mesh:new X(this.gl,{geometry:this.geometry,program:n}),program:n,uniforms:i,enabled:s,textureUniform:r};return this.passes.push(a),a}resize(){let{width:t,height:e,dpr:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i&&(this.dpr=i),t&&(this.width=t,this.height=e||t),i=this.dpr||this.gl.renderer.dpr,t=(this.width||this.gl.renderer.width)*i,e=(this.height||this.gl.renderer.height)*i,this.options.width=t,this.options.height=e,this.fbo.read=new Q(this.gl,this.options),this.fbo.write=new Q(this.gl,this.options)}render(t){let{scene:e,camera:i,target:r=null,update:s=!0,sort:n=!0,frustumCull:a=!0}=t;const h=this.passes.filter(t=>t.enabled);this.gl.renderer.render({scene:e,camera:i,target:h.length?this.fbo.write:r,update:s,sort:n,frustumCull:a}),this.fbo.swap(),h.forEach((t,e)=>{t.mesh.program.uniforms[t.textureUniform].value=this.fbo.read.texture,this.gl.renderer.render({scene:t.mesh,target:e===h.length-1?r:this.fbo.write,clear:!1}),this.fbo.swap()})}},e.Program=x,e.Quat=B,e.Raycast=class{constructor(t){this.gl=t,this.origin=new d,this.direction=new d}castMouse(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0];t.worldMatrix.getTranslation(this.origin),this.direction.set(e[0],e[1],.5),t.unproject(this.direction),this.direction.sub(this.origin).normalize()}intersectBounds(t){Array.isArray(t)||(t=[t]);const e=ft,i=gt,r=pt,s=[];return t.forEach(t=>{t.geometry.bounds||t.geometry.computeBoundingBox(),"sphere"===t.geometry.raycast&&t.geometry.bounds===1/0&&t.geometry.computeBoundingSphere(),e.inverse(t.worldMatrix),i.copy(this.origin).applyMatrix4(e),r.copy(this.direction).transformDirection(e);let n=0;n="sphere"===t.geometry.raycast?this.intersectSphere(t.geometry.bounds,i,r):this.intersectBox(t.geometry.bounds,i,r),n&&(t.hit||(t.hit={localPoint:new d}),t.hit.distance=n,t.hit.localPoint.copy(r).multiply(n).add(i),s.push(t))}),s.sort((t,e)=>t.hit.distance-e.hit.distance),s}intersectSphere(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.origin,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.direction;const r=mt;r.sub(t.center,e);const s=r.dot(i),n=r.dot(r)-s*s,a=t.radius*t.radius;if(n>a)return 0;const h=Math.sqrt(a-n),o=s-h,l=s+h;return o<0&&l<0?0:o<0?l:o}intersectBox(t){let e,i,r,s,n,a,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.origin,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.direction;const l=1/o.x,u=1/o.y,d=1/o.z,c=t.min,g=t.max;return e=((l>=0?c.x:g.x)-h.x)*l,i=((l>=0?g.x:c.x)-h.x)*l,r=((u>=0?c.y:g.y)-h.y)*u,s=((u>=0?g.y:c.y)-h.y)*u,e>s||r>i?0:(r>e&&(e=r),s<i&&(i=s),n=((d>=0?c.z:g.z)-h.z)*d,a=((d>=0?g.z:c.z)-h.z)*d,e>a||n>i?0:(n>e&&(e=n),a<i&&(i=a),i<0?0:e>=0?e:i))}},e.RenderTarget=Q,e.Renderer=class{constructor(){let{canvas:t=document.createElement("canvas"),width:e=300,height:i=150,dpr:r=1,alpha:s=!1,depth:n=!0,stencil:a=!1,antialias:h=!1,premultipliedAlpha:o=!1,preserveDrawingBuffer:l=!1,powerPreference:u="default",autoClear:d=!0,webgl:c=2}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const g={alpha:s,depth:n,stencil:a,antialias:h,premultipliedAlpha:o,preserveDrawingBuffer:l,powerPreference:u};this.dpr=r,this.alpha=s,this.color=!0,this.depth=n,this.stencil=a,this.premultipliedAlpha=o,this.autoClear=d,2===c&&(this.gl=t.getContext("webgl2",g)),this.isWebgl2=!!this.gl,this.gl||(this.gl=t.getContext("webgl",g)||t.getContext("experimental-webgl",g)),this.gl.renderer=this,this.setSize(e,i),this.parameters={},this.parameters.maxTextureUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.state={},this.state.blendFunc={src:this.gl.ONE,dst:this.gl.ZERO},this.state.blendEquation={modeRGB:this.gl.FUNC_ADD},this.state.cullFace=null,this.state.frontFace=this.gl.CCW,this.state.depthMask=!0,this.state.depthFunc=this.gl.LESS,this.state.premultiplyAlpha=!1,this.state.flipY=!1,this.state.unpackAlignment=4,this.state.framebuffer=null,this.state.viewport={width:null,height:null},this.state.textureUnits=[],this.state.activeTextureUnit=0,this.state.boundBuffer=null,this.state.uniformLocations=new Map,this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL")}setSize(t,e){this.width=t,this.height=e,this.gl.canvas.width=t*this.dpr,this.gl.canvas.height=e*this.dpr,Object.assign(this.gl.canvas.style,{width:t+"px",height:e+"px"})}setViewport(t,e){this.state.viewport.width===t&&this.state.viewport.height===e||(this.state.viewport.width=t,this.state.viewport.height=e,this.gl.viewport(0,0,t,e))}enable(t){!0!==this.state[t]&&(this.gl.enable(t),this.state[t]=!0)}disable(t){!1!==this.state[t]&&(this.gl.disable(t),this.state[t]=!1)}setBlendFunc(t,e,i,r){this.state.blendFunc.src===t&&this.state.blendFunc.dst===e&&this.state.blendFunc.srcAlpha===i&&this.state.blendFunc.dstAlpha===r||(this.state.blendFunc.src=t,this.state.blendFunc.dst=e,this.state.blendFunc.srcAlpha=i,this.state.blendFunc.dstAlpha=r,void 0!==i?this.gl.blendFuncSeparate(t,e,i,r):this.gl.blendFunc(t,e))}setBlendEquation(t,e){this.state.blendEquation.modeRGB===t&&this.state.blendEquation.modeAlpha===e||(this.state.blendEquation.modeRGB=t,this.state.blendEquation.modeAlpha=e,void 0!==e?this.gl.blendEquationSeparate(t,e):this.gl.blendEquation(t))}setCullFace(t){this.state.cullFace!==t&&(this.state.cullFace=t,this.gl.cullFace(t))}setFrontFace(t){this.state.frontFace!==t&&(this.state.frontFace=t,this.gl.frontFace(t))}setDepthMask(t){this.state.depthMask!==t&&(this.state.depthMask=t,this.gl.depthMask(t))}setDepthFunc(t){this.state.depthFunc!==t&&(this.state.depthFunc=t,this.gl.depthFunc(t))}activeTexture(t){this.state.activeTextureUnit!==t&&(this.state.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))}bindFramebuffer(){let{target:t=this.gl.FRAMEBUFFER,buffer:e=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.state.framebuffer!==e&&(this.state.framebuffer=e,this.gl.bindFramebuffer(t,e))}getExtension(t,e,i){return e&&this.gl[e]?this.gl[e].bind(this.gl):(this.extensions[t]||(this.extensions[t]=this.gl.getExtension(t)),e?this.extensions[t]?this.extensions[t][i].bind(this.extensions[t]):null:this.extensions[t])}sortOpaque(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:t.zDepth!==e.zDepth?t.zDepth-e.zDepth:e.id-t.id}sortTransparent(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.zDepth!==e.zDepth?e.zDepth-t.zDepth:e.id-t.id}sortUI(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:e.id-t.id}getRenderList(t){let{scene:e,camera:i,frustumCull:r,sort:s}=t,n=[];if(i&&r&&i.updateFrustum(),e.traverse(t=>{if(!t.visible)return!0;t.draw&&(r&&t.frustumCulled&&i&&!i.frustumIntersectsMesh(t)||n.push(t))}),s){const t=[],e=[],r=[];n.forEach(s=>{s.program.transparent?s.program.depthTest?e.push(s):r.push(s):t.push(s),s.zDepth=0,0===s.renderOrder&&s.program.depthTest&&i&&(s.worldMatrix.getTranslation(A),A.applyMatrix4(i.projectionViewMatrix),s.zDepth=A.z)}),t.sort(this.sortOpaque),e.sort(this.sortTransparent),r.sort(this.sortUI),n=t.concat(e,r)}return n}render(t){let{scene:e,camera:i,target:r=null,update:s=!0,sort:n=!0,frustumCull:a=!0,clear:h}=t;null===r?(this.bindFramebuffer(),this.setViewport(this.width*this.dpr,this.height*this.dpr)):(this.bindFramebuffer(r),this.setViewport(r.width,r.height)),(h||this.autoClear&&!1!==h)&&(!this.depth||r&&!r.depth||(this.enable(this.gl.DEPTH_TEST),this.setDepthMask(!0)),this.gl.clear((this.color?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),s&&e.updateMatrixWorld(),i&&null===i.parent&&i.updateMatrixWorld();this.getRenderList({scene:e,camera:i,frustumCull:a,sort:n}).forEach(t=>{t.draw({camera:i})})}},e.Shadow=class{constructor(t,e){let{light:i=new k(t),width:r=1024,height:s=r}=e;this.gl=t,this.light=i,this.target=new Q(t,{width:r,height:s}),this.depthProgram=new x(t,{vertex:Ut,fragment:Nt,cullFace:null}),this.castMeshes=[]}add(t){let{mesh:e,receive:i=!0,cast:r=!0,vertex:s=Ut,fragment:n=Nt,uniformProjection:a="shadowProjectionMatrix",uniformView:h="shadowViewMatrix",uniformTexture:o="tShadow"}=t;i&&!e.program.uniforms[a]&&(e.program.uniforms[a]={value:this.light.projectionMatrix},e.program.uniforms[h]={value:this.light.viewMatrix},e.program.uniforms[o]={value:this.target.texture}),r&&(this.castMeshes.push(e),e.colorProgram=e.program,e.depthProgram||(e.depthProgram=s!==Ut||n!==Nt?new x(gl,{vertex:s,fragment:n,cullFace:null}):this.depthProgram))}render(t){let{scene:e}=t;e.traverse(t=>{t.draw&&(~this.castMeshes.indexOf(t)?t.program=t.depthProgram:(t.visible&&(t.isForceVisibility=!0),t.visible=!1))}),this.gl.renderer.render({scene:e,camera:this.light,target:this.target}),e.traverse(t=>{t.draw&&(~this.castMeshes.indexOf(t)?t.program=t.colorProgram:t.isForceVisibility&&(t.visible=!0))})}},e.Skin=class extends X{constructor(t){let{rig:e,geometry:i,program:r,mode:s=t.TRIANGLES}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(t,{geometry:i,program:r,mode:s}),this.createBones(e),this.createBoneTexture(),this.animations=[],Object.assign(this.program.uniforms,{boneTexture:{value:this.boneTexture},boneTextureSize:{value:this.boneTextureSize}})}createBones(t){if(this.root=new D,this.bones=[],t.bones&&t.bones.length){for(let e=0;e<t.bones.length;e++){const i=new D;i.position.fromArray(t.bindPose.position,3*e),i.quaternion.fromArray(t.bindPose.quaternion,4*e),i.scale.fromArray(t.bindPose.scale,3*e),this.bones.push(i)}t.bones.forEach((t,e)=>{if(this.bones[e].name=t.name,-1===t.parent)return this.bones[e].setParent(this.root);this.bones[e].setParent(this.bones[t.parent])}),this.root.updateMatrixWorld(!0),this.bones.forEach(t=>{t.bindInverse=new U(...t.worldMatrix).inverse()})}}createBoneTexture(){if(!this.bones.length)return;const t=Math.max(4,Math.pow(2,Math.ceil(Math.log(Math.sqrt(4*this.bones.length))/Math.LN2)));this.boneMatrices=new Float32Array(t*t*4),this.boneTextureSize=t,this.boneTexture=new Z(this.gl,{image:this.boneMatrices,generateMipmaps:!1,type:this.gl.FLOAT,internalFormat:this.gl.renderer.isWebgl2?this.gl.RGBA16F:this.gl.RGBA,flipY:!1,width:t})}addAnimation(t){const e=new Ft({objects:this.bones,data:t});return this.animations.push(e),e}update(){let t=0;this.animations.forEach(e=>t+=e.weight),this.animations.forEach((e,i)=>{e.update(t,0===i)})}draw(){let{camera:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.root.updateMatrixWorld(!0),this.bones.forEach((t,e)=>{Tt.multiply(t.worldMatrix,t.bindInverse),this.boneMatrices.set(Tt,16*e)}),this.boneTexture&&(this.boneTexture.needsUpdate=!0),super.draw({camera:t})}},e.Sphere=class extends m{constructor(t){let{radius:e=.5,widthSegments:i=16,heightSegments:r=Math.ceil(.5*i),phiStart:s=0,phiLength:n=2*Math.PI,thetaStart:a=0,thetaLength:h=Math.PI,attributes:o={}}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const l=i,u=r,c=s,g=n,p=a,m=h,f=(l+1)*(u+1),v=l*u*6,x=new Float32Array(3*f),w=new Float32Array(3*f),b=new Float32Array(2*f),M=f>65536?new Uint32Array(v):new Uint16Array(v);let y=0,A=0,E=0,F=p+m;const T=[];let _=new d;for(let d=0;d<=u;d++){let t=[],i=d/u;for(let r=0;r<=l;r++,y++){let s=r/l,n=-e*Math.cos(c+s*g)*Math.sin(p+i*m),a=e*Math.cos(p+i*m),h=e*Math.sin(c+s*g)*Math.sin(p+i*m);x[3*y]=n,x[3*y+1]=a,x[3*y+2]=h,_.set(n,a,h).normalize(),w[3*y]=_.x,w[3*y+1]=_.y,w[3*y+2]=_.z,b[2*y]=s,b[2*y+1]=1-i,t.push(A++)}T.push(t)}for(let d=0;d<u;d++)for(let t=0;t<l;t++){let e=T[d][t+1],i=T[d][t],r=T[d+1][t],s=T[d+1][t+1];(0!==d||p>0)&&(M[3*E]=e,M[3*E+1]=i,M[3*E+2]=s,E++),(d!==u-1||F<Math.PI)&&(M[3*E]=i,M[3*E+1]=r,M[3*E+2]=s,E++)}Object.assign(o,{position:{size:3,data:x},normal:{size:3,data:w},uv:{size:2,data:b},index:{data:M}}),super(t,o)}},e.Text=function(t){let{font:e,text:i,width:r=1/0,align:s="left",size:n=1,letterSpacing:a=0,lineHeight:h=1.4,wordSpacing:o=0,wordBreak:l=!1}=t;const u=this;let d,c,g,p,m;const f=/\n/,v=/\s/;function x(){g=e.common.lineHeight,p=e.common.base,m=n/p;let t=i.replace(/[ \n]/g,"").length;c={position:new Float32Array(4*t*3),uv:new Float32Array(4*t*2),id:new Float32Array(4*t),index:new Uint16Array(6*t)};for(let e=0;e<t;e++)c.id[e]=e,c.index.set([4*e,4*e+2,4*e+1,4*e+1,4*e+2,4*e+3],6*e);w()}function w(){const t=[];let g=0,p=0,x=0,w=M();function M(){const e={width:0,glyphs:[]};return t.push(e),p=g,x=0,e}let y=0;for(;g<i.length&&y<100;){y++;const t=i[g];if(!w.width&&v.test(t)){g++,p=g,x=0;continue}if(f.test(t)){g++,w=M();continue}const e=d[t];if(w.glyphs.length){const t=w.glyphs[w.glyphs.length-1][0];let i=b(e.id,t.id)*m;w.width+=i,x+=i}w.glyphs.push([e,w.width]);let s=0;if(v.test(t)?(p=g,x=0,s+=o*n):s+=a*n,s+=e.xadvance*m,w.width+=s,x+=s,w.width>r){if(l&&w.glyphs.length>1){w.width-=s,w.glyphs.pop(),w=M();continue}if(!l&&x!==w.width){let t=g-p+1;w.glyphs.splice(-t,t),g=p,w.width-=x,w=M();continue}}g++}w.width||t.pop(),function(t){const i=e.common.scaleW,r=e.common.scaleH;let a=.07*n,o=0;for(let e=0;e<t.length;e++){let l=t[e];for(let t=0;t<l.glyphs.length;t++){const e=l.glyphs[t][0];let n=l.glyphs[t][1];if("center"===s?n-=.5*l.width:"right"===s&&(n-=l.width),v.test(e.char))continue;n+=e.xoffset*m,a-=e.yoffset*m;let h=e.width*m,u=e.height*m;c.position.set([n,a-u,0,n,a,0,n+h,a-u,0,n+h,a,0],4*o*3);let d=e.x/i,g=e.width/i,p=1-e.y/r,f=e.height/r;c.uv.set([d,p-f,d,p,d+g,p-f,d+g,p],4*o*2),a+=e.yoffset*m,o++}a-=n*h}u.buffers=c,u.numLines=t.length,u.height=u.numLines*n*h}(t)}function b(t,i){for(let r=0;r<e.kernings.length;r++){let s=e.kernings[r];if(!(s.first<t)&&!(s.second<i))return s.first>t||s.first===t&&s.second>i?0:s.amount}return 0}d={},e.chars.forEach(t=>d[t.char]=t),x(),this.resize=function(t){({width:r}=t),w()},this.update=function(t){({text:i}=t),x()}},e.Texture=Z,e.Transform=D,e.Vec2=rt,e.Vec3=d,e.Vec4=class extends Array{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:t),this}get x(){return this[0]}set x(t){this[0]=t}get y(){return this[1]}set y(t){this[1]=t}get z(){return this[2]}set z(t){this[2]=t}get w(){return this[3]}set w(t){this[3]=t}set(t,e,i,r){return t.length?this.copy(t):(F(this,t,e,i,r),this)}copy(t){return E(this,t),this}normalize(){return T(this,this),this}fromArray(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this[0]=t[e],this[1]=t[e+1],this[2]=t[e+2],this[3]=t[e+3],this}toArray(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t[e]=this[0],t[e+1]=this[1],t[e+2]=this[2],t[e+3]=this[3],t}}}}]);
//# sourceMappingURL=7bfda8e4-94ff127895d1abf5be71.js.map